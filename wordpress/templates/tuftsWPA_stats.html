{% extends 'base.html' %}

{% block header %}
<header>
	<h2>{{ header }}</h2>
</header>
{% endblock %}

{% block visuals %}
	{% if db_object.level == "page" %}
		{% load staticfiles %}
		<script src={% static "d3.js" %}></script>
		<script src={% static "d3.layout.cloud.js" %}></script>
		<script src="https://code.jquery.com/jquery-2.1.0.min.js"></script>
		<script src={% static "custom.js" %}></script>
		<link rel="stylesheet" type="text/css" href= {% static "main.css" %}>
		<script>

			var width = $("body").width();
			var height = $(window).height() * 0.7;
			var fill = d3.scale.category20();
			var temp = {{word_count_json|safe}}.slice(0, 150);

			var sum = 0;
			var i = temp.length;
			while(--i){
			sum += temp[i][1];
			}

		  	d3.layout.cloud().size([width, height])
		      	.words(temp.map(function(d) {
		        	return {text: d[0], size: d[1]*15};
		      	}))
		      	.padding(4)
		      	.rotate(function() { return ~~(Math.random() * 2) * 90; })
		      	.font("Impact")
		      	.fontSize(function(d) { return d.size; })
		      	.on("end", draw)
		      	.start();

		  	function draw(words) {
		    	d3.select("body").append("svg")
		        	.attr("width", width)
		        	.attr("height", height)
		        	.style("align", "center")
		      	.append("g")
		        	.attr("transform", "translate("+width/2+","+height/2+")")
		      	.selectAll("text")
		        	.data(words)
		      	.enter().append("text")
		        	.style("font-size", function(d) { return d.size + "px"; })
		        	.style("font-family", "Arialb")
		        	.style("fill", function(d, i) { return fill(i); })
		        	.attr("text-anchor", "middle")
		        	.attr("transform", function(d) {
		          		return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
		        	})
		        	.text(function(d) { return d.text; });
		  		}
		</script>
	{% endif %}
{% endblock %}



{% block content %}
	<p>Url : <a href="{{db_object.url}}" target="_blank">{{db_object.url}}</a></p>
	{% if db_object.level == "site" %}
		<p>Last Scraped : {{db_object.published}}</p>
	{% else %}
		<p>Published : {{db_object.published}}</p>
	{% endif %}
	{% if db_object.level == "site" %}
		<table>
			<tr><th>Post</th><th>Analysis</th><th>Published</th><th>Url</th></tr>
			{% for item in sub_pages %}
				<tr>
					<td>{{item.title}}</td>
					<td><a href="/wordpress/stats?url={{item.url}}&level={{item.level}}">Results</a></td>
					<td>{{item.published}}</td>
					<td><a href="{{item.url}}" target="_blank">Link</a></td>
				</tr>
			{% endfor %}
		</table>
	{% else %}
		
		<table>
			<tr><th>Word</th><th>Frequency</th></tr>
			{% for word, count in word_count %}
				<tr><td>{{word}}</td><td>{{count}}</td></tr>
			{% endfor %}
		</table>
		<h3>Text : </h3>
		<p>{{db_object.content}}</p>
	{% endif %}

{% endblock %}

{% block staticfiles %}
	{% load staticfiles %}
	<link rel="stylesheet" type="text/css" href= {% static "main.css" %}>
{% endblock %}

